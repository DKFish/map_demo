define(["exports","./when","./Check","./Math","./Cartesian2"],function(e,f,t,m,s){"use strict";function i(e,t,a,i){t=f.defaultValue(t,0),a=f.defaultValue(a,0),i=f.defaultValue(i,0),e._radii=new s.Cartesian3(t,a,i),e._radiiSquared=new s.Cartesian3(t*t,a*a,i*i),e._radiiToTheFourth=new s.Cartesian3(t*t*t*t,a*a*a*a,i*i*i*i),e._oneOverRadii=new s.Cartesian3(0===t?0:1/t,0===a?0:1/a,0===i?0:1/i),e._oneOverRadiiSquared=new s.Cartesian3(0===t?0:1/(t*t),0===a?0:1/(a*a),0===i?0:1/(i*i)),e._minimumRadius=Math.min(t,a,i),e._maximumRadius=Math.max(t,a,i),e._centerToleranceSquared=m.CesiumMath.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function C(e,t,a){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,i(this,e,t,a)}Object.defineProperties(C.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),C.clone=function(e,t){if(f.defined(e)){var a=e._radii;return f.defined(t)?(s.Cartesian3.clone(a,t._radii),s.Cartesian3.clone(e._radiiSquared,t._radiiSquared),s.Cartesian3.clone(e._radiiToTheFourth,t._radiiToTheFourth),s.Cartesian3.clone(e._oneOverRadii,t._oneOverRadii),s.Cartesian3.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new C(a.x,a.y,a.z)}},C.fromCartesian3=function(e,t){return f.defined(t)||(t=new C),f.defined(e)&&i(t,e.x,e.y,e.z),t},C.WGS84=Object.freeze(new C(6378137,6378137,6356752.314245179)),C.UNIT_SPHERE=Object.freeze(new C(1,1,1)),C.MOON=Object.freeze(new C(m.CesiumMath.LUNAR_RADIUS,m.CesiumMath.LUNAR_RADIUS,m.CesiumMath.LUNAR_RADIUS)),C.prototype.clone=function(e){return C.clone(this,e)},C.packedLength=s.Cartesian3.packedLength,C.pack=function(e,t,a){return a=f.defaultValue(a,0),s.Cartesian3.pack(e._radii,t,a),t},C.unpack=function(e,t,a){t=f.defaultValue(t,0);var i=s.Cartesian3.unpack(e,t);return C.fromCartesian3(i,a)},C.prototype.geocentricSurfaceNormal=s.Cartesian3.normalize,C.prototype.geodeticSurfaceNormalCartographic=function(e,t){var a=e.longitude,i=e.latitude,n=Math.cos(i),r=n*Math.cos(a),u=n*Math.sin(a),o=Math.sin(i);return f.defined(t)||(t=new s.Cartesian3),t.x=r,t.y=u,t.z=o,s.Cartesian3.normalize(t,t)},C.prototype.geodeticSurfaceNormal=function(e,t){return f.defined(t)||(t=new s.Cartesian3),t=s.Cartesian3.multiplyComponents(e,this._oneOverRadiiSquared,t),s.Cartesian3.normalize(t,t)};var r=new s.Cartesian3,u=new s.Cartesian3;C.prototype.cartographicToCartesian=function(e,t){var a=r,i=u;this.geodeticSurfaceNormalCartographic(e,a),s.Cartesian3.multiplyComponents(this._radiiSquared,a,i);var n=Math.sqrt(s.Cartesian3.dot(a,i));return s.Cartesian3.divideByScalar(i,n,i),s.Cartesian3.multiplyByScalar(a,e.height,a),f.defined(t)||(t=new s.Cartesian3),s.Cartesian3.add(i,a,t)},C.prototype.cartographicArrayToCartesianArray=function(e,t){var a=e.length;f.defined(t)?t.length=a:t=new Array(a);for(var i=0;i<a;i++)t[i]=this.cartographicToCartesian(e[i],t[i]);return t};var h=new s.Cartesian3,d=new s.Cartesian3,c=new s.Cartesian3;function M(e,t,a,i){this.west=f.defaultValue(e,0),this.south=f.defaultValue(t,0),this.east=f.defaultValue(a,0),this.north=f.defaultValue(i,0)}C.prototype.cartesianToCartographic=function(e,t){var a=this.scaleToGeodeticSurface(e,d);if(f.defined(a)){var i=this.geodeticSurfaceNormal(a,h),n=s.Cartesian3.subtract(e,a,c),r=Math.atan2(i.y,i.x),u=Math.asin(i.z),o=m.CesiumMath.sign(s.Cartesian3.dot(n,e))*s.Cartesian3.magnitude(n);return f.defined(t)?(t.longitude=r,t.latitude=u,t.height=o,t):new s.Cartographic(r,u,o)}},C.prototype.cartesianArrayToCartographicArray=function(e,t){var a=e.length;f.defined(t)?t.length=a:t=new Array(a);for(var i=0;i<a;++i)t[i]=this.cartesianToCartographic(e[i],t[i]);return t},C.prototype.scaleToGeodeticSurface=function(e,t){return s.scaleToGeodeticSurface(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},C.prototype.scaleToGeocentricSurface=function(e,t){f.defined(t)||(t=new s.Cartesian3);var a=e.x,i=e.y,n=e.z,r=this._oneOverRadiiSquared,u=1/Math.sqrt(a*a*r.x+i*i*r.y+n*n*r.z);return s.Cartesian3.multiplyByScalar(e,u,t)},C.prototype.transformPositionToScaledSpace=function(e,t){return f.defined(t)||(t=new s.Cartesian3),s.Cartesian3.multiplyComponents(e,this._oneOverRadii,t)},C.prototype.transformPositionFromScaledSpace=function(e,t){return f.defined(t)||(t=new s.Cartesian3),s.Cartesian3.multiplyComponents(e,this._radii,t)},C.prototype.equals=function(e){return this===e||f.defined(e)&&s.Cartesian3.equals(this._radii,e._radii)},C.prototype.toString=function(){return this._radii.toString()},C.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,a){t=f.defaultValue(t,0);var i=this._squaredXOverSquaredZ;if(f.defined(a)||(a=new s.Cartesian3),a.x=0,a.y=0,a.z=e.z*(1-i),!(Math.abs(a.z)>=this._radii.z-t))return a},Object.defineProperties(M.prototype,{width:{get:function(){return M.computeWidth(this)}},height:{get:function(){return M.computeHeight(this)}}}),M.packedLength=4,M.pack=function(e,t,a){return a=f.defaultValue(a,0),t[a++]=e.west,t[a++]=e.south,t[a++]=e.east,t[a]=e.north,t},M.unpack=function(e,t,a){return t=f.defaultValue(t,0),f.defined(a)||(a=new M),a.west=e[t++],a.south=e[t++],a.east=e[t++],a.north=e[t],a},M.computeWidth=function(e){var t=e.east,a=e.west;return t<a&&(t+=m.CesiumMath.TWO_PI),t-a},M.computeHeight=function(e){return e.north-e.south},M.fromDegrees=function(e,t,a,i,n){return e=m.CesiumMath.toRadians(f.defaultValue(e,0)),t=m.CesiumMath.toRadians(f.defaultValue(t,0)),a=m.CesiumMath.toRadians(f.defaultValue(a,0)),i=m.CesiumMath.toRadians(f.defaultValue(i,0)),f.defined(n)?(n.west=e,n.south=t,n.east=a,n.north=i,n):new M(e,t,a,i)},M.fromRadians=function(e,t,a,i,n){return f.defined(n)?(n.west=f.defaultValue(e,0),n.south=f.defaultValue(t,0),n.east=f.defaultValue(a,0),n.north=f.defaultValue(i,0),n):new M(e,t,a,i)},M.fromCartographicArray=function(e,t){for(var a=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,u=Number.MAX_VALUE,o=-Number.MAX_VALUE,s=0,h=e.length;s<h;s++){var d=e[s];a=Math.min(a,d.longitude),i=Math.max(i,d.longitude),u=Math.min(u,d.latitude),o=Math.max(o,d.latitude);var c=0<=d.longitude?d.longitude:d.longitude+m.CesiumMath.TWO_PI;n=Math.min(n,c),r=Math.max(r,c)}return r-n<i-a&&(a=n,(i=r)>m.CesiumMath.PI&&(i-=m.CesiumMath.TWO_PI),a>m.CesiumMath.PI&&(a-=m.CesiumMath.TWO_PI)),f.defined(t)?(t.west=a,t.south=u,t.east=i,t.north=o,t):new M(a,u,i,o)},M.fromCartesianArray=function(e,t,a){t=f.defaultValue(t,C.WGS84);for(var i=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=Number.MAX_VALUE,u=-Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,h=0,d=e.length;h<d;h++){var c=t.cartesianToCartographic(e[h]);i=Math.min(i,c.longitude),n=Math.max(n,c.longitude),o=Math.min(o,c.latitude),s=Math.max(s,c.latitude);var l=0<=c.longitude?c.longitude:c.longitude+m.CesiumMath.TWO_PI;r=Math.min(r,l),u=Math.max(u,l)}return u-r<n-i&&(i=r,(n=u)>m.CesiumMath.PI&&(n-=m.CesiumMath.TWO_PI),i>m.CesiumMath.PI&&(i-=m.CesiumMath.TWO_PI)),f.defined(a)?(a.west=i,a.south=o,a.east=n,a.north=s,a):new M(i,o,n,s)},M.clone=function(e,t){if(f.defined(e))return f.defined(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new M(e.west,e.south,e.east,e.north)},M.equalsEpsilon=function(e,t,a){return a=f.defaultValue(a,0),e===t||f.defined(e)&&f.defined(t)&&Math.abs(e.west-t.west)<=a&&Math.abs(e.south-t.south)<=a&&Math.abs(e.east-t.east)<=a&&Math.abs(e.north-t.north)<=a},M.prototype.clone=function(e){return M.clone(this,e)},M.prototype.equals=function(e){return M.equals(this,e)},M.equals=function(e,t){return e===t||f.defined(e)&&f.defined(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north},M.prototype.equalsEpsilon=function(e,t){return M.equalsEpsilon(this,e,t)},M.validate=function(e){},M.southwest=function(e,t){return f.defined(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new s.Cartographic(e.west,e.south)},M.northwest=function(e,t){return f.defined(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new s.Cartographic(e.west,e.north)},M.northeast=function(e,t){return f.defined(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new s.Cartographic(e.east,e.north)},M.southeast=function(e,t){return f.defined(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new s.Cartographic(e.east,e.south)},M.center=function(e,t){var a=e.east,i=e.west;a<i&&(a+=m.CesiumMath.TWO_PI);var n=m.CesiumMath.negativePiToPi(.5*(i+a)),r=.5*(e.south+e.north);return f.defined(t)?(t.longitude=n,t.latitude=r,t.height=0,t):new s.Cartographic(n,r)},M.intersection=function(e,t,a){var i=e.east,n=e.west,r=t.east,u=t.west;i<n&&0<r?i+=m.CesiumMath.TWO_PI:r<u&&0<i&&(r+=m.CesiumMath.TWO_PI),i<n&&u<0?u+=m.CesiumMath.TWO_PI:r<u&&n<0&&(n+=m.CesiumMath.TWO_PI);var o=m.CesiumMath.negativePiToPi(Math.max(n,u)),s=m.CesiumMath.negativePiToPi(Math.min(i,r));if(!((e.west<e.east||t.west<t.east)&&s<=o)){var h=Math.max(e.south,t.south),d=Math.min(e.north,t.north);if(!(d<=h))return f.defined(a)?(a.west=o,a.south=h,a.east=s,a.north=d,a):new M(o,h,s,d)}},M.simpleIntersection=function(e,t,a){var i=Math.max(e.west,t.west),n=Math.max(e.south,t.south),r=Math.min(e.east,t.east),u=Math.min(e.north,t.north);if(!(u<=n||r<=i))return f.defined(a)?(a.west=i,a.south=n,a.east=r,a.north=u,a):new M(i,n,r,u)},M.union=function(e,t,a){f.defined(a)||(a=new M);var i=e.east,n=e.west,r=t.east,u=t.west;i<n&&0<r?i+=m.CesiumMath.TWO_PI:r<u&&0<i&&(r+=m.CesiumMath.TWO_PI),i<n&&u<0?u+=m.CesiumMath.TWO_PI:r<u&&n<0&&(n+=m.CesiumMath.TWO_PI);var o=m.CesiumMath.convertLongitudeRange(Math.min(n,u)),s=m.CesiumMath.convertLongitudeRange(Math.max(i,r));return a.west=o,a.south=Math.min(e.south,t.south),a.east=s,a.north=Math.max(e.north,t.north),a},M.expand=function(e,t,a){return f.defined(a)||(a=new M),a.west=Math.min(e.west,t.longitude),a.south=Math.min(e.south,t.latitude),a.east=Math.max(e.east,t.longitude),a.north=Math.max(e.north,t.latitude),a},M.contains=function(e,t){var a=t.longitude,i=t.latitude,n=e.west,r=e.east;return r<n&&(r+=m.CesiumMath.TWO_PI,a<0&&(a+=m.CesiumMath.TWO_PI)),(n<a||m.CesiumMath.equalsEpsilon(a,n,m.CesiumMath.EPSILON14))&&(a<r||m.CesiumMath.equalsEpsilon(a,r,m.CesiumMath.EPSILON14))&&i>=e.south&&i<=e.north};var l=new s.Cartographic;M.subsample=function(e,t,a,i){t=f.defaultValue(t,C.WGS84),a=f.defaultValue(a,0),f.defined(i)||(i=[]);var n=0,r=e.north,u=e.south,o=e.east,s=e.west,h=l;h.height=a,h.longitude=s,h.latitude=r,i[n]=t.cartographicToCartesian(h,i[n]),n++,h.longitude=o,i[n]=t.cartographicToCartesian(h,i[n]),n++,h.latitude=u,i[n]=t.cartographicToCartesian(h,i[n]),n++,h.longitude=s,i[n]=t.cartographicToCartesian(h,i[n]),n++,h.latitude=r<0?r:0<u?u:0;for(var d=1;d<8;++d)h.longitude=-Math.PI+d*m.CesiumMath.PI_OVER_TWO,M.contains(e,h)&&(i[n]=t.cartographicToCartesian(h,i[n]),n++);return 0===h.latitude&&(h.longitude=s,i[n]=t.cartographicToCartesian(h,i[n]),n++,h.longitude=o,i[n]=t.cartographicToCartesian(h,i[n]),n++),i.length=n,i},M.MAX_VALUE=Object.freeze(new M(-Math.PI,-m.CesiumMath.PI_OVER_TWO,Math.PI,m.CesiumMath.PI_OVER_TWO)),e.Ellipsoid=C,e.Rectangle=M});
